{
  "version": 3,
  "sources": ["../../../../../../../../../../src/trigger/tasks/llm-task.ts"],
  "sourcesContent": ["import { task } from \"@trigger.dev/sdk/v3\";\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\ninterface LLMTaskPayload {\r\n    model: string;\r\n    systemPrompt: string;\r\n    userMessage: string;\r\n    images: string[];\r\n    nodeId: string;\r\n    runId: string;\r\n}\r\n\r\nexport const llmTask = task({\r\n    id: \"llm-execution\",\r\n    maxDuration: 120, // 2 minutes\r\n    retry: {\r\n        maxAttempts: 2,\r\n    },\r\n    run: async (payload: LLMTaskPayload) => {\r\n        const { model, systemPrompt, userMessage, images, nodeId, runId } = payload;\r\n\r\n        const apiKey = process.env.GOOGLE_AI_API_KEY;\r\n        if (!apiKey) {\r\n            throw new Error(\"GOOGLE_AI_API_KEY is not configured\");\r\n        }\r\n\r\n        const genAI = new GoogleGenerativeAI(apiKey);\r\n        const modelInstance = genAI.getGenerativeModel({ model });\r\n\r\n        // Build parts array\r\n        const parts: Array<{ text: string } | { inlineData: { mimeType: string; data: string } }> = [];\r\n\r\n        if (systemPrompt) {\r\n            parts.push({ text: `System: ${systemPrompt}\\n\\n` });\r\n        }\r\n\r\n        parts.push({ text: userMessage });\r\n\r\n        // Add images if provided\r\n        for (const imageUrl of images) {\r\n            try {\r\n                const response = await fetch(imageUrl);\r\n                const buffer = await response.arrayBuffer();\r\n                const base64 = Buffer.from(buffer).toString(\"base64\");\r\n                const mimeType = response.headers.get(\"content-type\") || \"image/jpeg\";\r\n\r\n                parts.push({\r\n                    inlineData: {\r\n                        mimeType,\r\n                        data: base64,\r\n                    },\r\n                });\r\n            } catch (error) {\r\n                console.warn(`Failed to fetch image: ${imageUrl}`, error);\r\n            }\r\n        }\r\n\r\n        const result = await modelInstance.generateContent(parts);\r\n        const response = result.response;\r\n        const text = response.text();\r\n\r\n        return {\r\n            nodeId,\r\n            runId,\r\n            response: text,\r\n            model,\r\n            tokensUsed: response.usageMetadata?.totalTokenCount || 0,\r\n        };\r\n    },\r\n});\r\n"],
  "mappings": ";;;;;;;;;;;;AAAA;AAYO,IAAM,UAAU,KAAK;AAAA,EACxB,IAAI;AAAA,EACJ,aAAa;AAAA;AAAA,EACb,OAAO;AAAA,IACH,aAAa;AAAA,EACjB;AAAA,EACA,KAAK,8BAAO,YAA4B;AACpC,UAAM,EAAE,OAAO,cAAc,aAAa,QAAQ,QAAQ,MAAM,IAAI;AAEpE,UAAM,SAAS,QAAQ,IAAI;AAC3B,QAAI,CAAC,QAAQ;AACT,YAAM,IAAI,MAAM,qCAAqC;AAAA,IACzD;AAEA,UAAM,QAAQ,IAAI,mBAAmB,MAAM;AAC3C,UAAM,gBAAgB,MAAM,mBAAmB,EAAE,MAAM,CAAC;AAGxD,UAAM,QAAsF,CAAC;AAE7F,QAAI,cAAc;AACd,YAAM,KAAK,EAAE,MAAM,WAAW,YAAY;AAAA;AAAA,EAAO,CAAC;AAAA,IACtD;AAEA,UAAM,KAAK,EAAE,MAAM,YAAY,CAAC;AAGhC,eAAW,YAAY,QAAQ;AAC3B,UAAI;AACA,cAAMA,YAAW,MAAM,MAAM,QAAQ;AACrC,cAAM,SAAS,MAAMA,UAAS,YAAY;AAC1C,cAAM,SAAS,OAAO,KAAK,MAAM,EAAE,SAAS,QAAQ;AACpD,cAAM,WAAWA,UAAS,QAAQ,IAAI,cAAc,KAAK;AAEzD,cAAM,KAAK;AAAA,UACP,YAAY;AAAA,YACR;AAAA,YACA,MAAM;AAAA,UACV;AAAA,QACJ,CAAC;AAAA,MACL,SAAS,OAAO;AACZ,gBAAQ,KAAK,0BAA0B,QAAQ,IAAI,KAAK;AAAA,MAC5D;AAAA,IACJ;AAEA,UAAM,SAAS,MAAM,cAAc,gBAAgB,KAAK;AACxD,UAAM,WAAW,OAAO;AACxB,UAAM,OAAO,SAAS,KAAK;AAE3B,WAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA,YAAY,SAAS,eAAe,mBAAmB;AAAA,IAC3D;AAAA,EACJ,GAlDK;AAmDT,CAAC;",
  "names": ["response"]
}
