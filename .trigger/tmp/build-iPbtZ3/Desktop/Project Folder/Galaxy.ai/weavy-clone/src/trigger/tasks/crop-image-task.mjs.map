{
  "version": 3,
  "sources": ["../../../../../../../../../../src/trigger/tasks/crop-image-task.ts"],
  "sourcesContent": ["import { task } from \"@trigger.dev/sdk/v3\";\r\nimport sharp from \"sharp\";\r\n\r\ninterface CropImagePayload {\r\n    imageUrl: string;\r\n    xPercent: number;\r\n    yPercent: number;\r\n    widthPercent: number;\r\n    heightPercent: number;\r\n    nodeId: string;\r\n    runId: string;\r\n}\r\n\r\nexport const cropImageTask = task({\r\n    id: \"crop-image\",\r\n    maxDuration: 60,\r\n    retry: {\r\n        maxAttempts: 2,\r\n    },\r\n    run: async (payload: CropImagePayload) => {\r\n        const { imageUrl, xPercent, yPercent, widthPercent, heightPercent, nodeId, runId } = payload;\r\n\r\n        // Fetch the image\r\n        const response = await fetch(imageUrl);\r\n        if (!response.ok) {\r\n            throw new Error(`Failed to fetch image: ${response.statusText}`);\r\n        }\r\n\r\n        const imageBuffer = Buffer.from(await response.arrayBuffer());\r\n\r\n        // Get image metadata\r\n        const metadata = await sharp(imageBuffer).metadata();\r\n        if (!metadata.width || !metadata.height) {\r\n            throw new Error(\"Could not determine image dimensions\");\r\n        }\r\n\r\n        // Calculate crop dimensions\r\n        const left = Math.round((xPercent / 100) * metadata.width);\r\n        const top = Math.round((yPercent / 100) * metadata.height);\r\n        const width = Math.round((widthPercent / 100) * metadata.width);\r\n        const height = Math.round((heightPercent / 100) * metadata.height);\r\n\r\n        // Crop the image\r\n        const croppedBuffer = await sharp(imageBuffer)\r\n            .extract({ left, top, width, height })\r\n            .toBuffer();\r\n\r\n        // Convert to base64 data URL\r\n        const base64 = croppedBuffer.toString(\"base64\");\r\n        const croppedUrl = `data:image/png;base64,${base64}`;\r\n\r\n        return {\r\n            nodeId,\r\n            runId,\r\n            croppedUrl,\r\n            originalDimensions: { width: metadata.width, height: metadata.height },\r\n            cropDimensions: { left, top, width, height },\r\n        };\r\n    },\r\n});\r\n"],
  "mappings": ";;;;;;;;;AAAA;AACA,OAAO,WAAW;AAYX,IAAM,gBAAgB,KAAK;AAAA,EAC9B,IAAI;AAAA,EACJ,aAAa;AAAA,EACb,OAAO;AAAA,IACH,aAAa;AAAA,EACjB;AAAA,EACA,KAAK,8BAAO,YAA8B;AACtC,UAAM,EAAE,UAAU,UAAU,UAAU,cAAc,eAAe,QAAQ,MAAM,IAAI;AAGrF,UAAM,WAAW,MAAM,MAAM,QAAQ;AACrC,QAAI,CAAC,SAAS,IAAI;AACd,YAAM,IAAI,MAAM,0BAA0B,SAAS,UAAU,EAAE;AAAA,IACnE;AAEA,UAAM,cAAc,OAAO,KAAK,MAAM,SAAS,YAAY,CAAC;AAG5D,UAAM,WAAW,MAAM,MAAM,WAAW,EAAE,SAAS;AACnD,QAAI,CAAC,SAAS,SAAS,CAAC,SAAS,QAAQ;AACrC,YAAM,IAAI,MAAM,sCAAsC;AAAA,IAC1D;AAGA,UAAM,OAAO,KAAK,MAAO,WAAW,MAAO,SAAS,KAAK;AACzD,UAAM,MAAM,KAAK,MAAO,WAAW,MAAO,SAAS,MAAM;AACzD,UAAM,QAAQ,KAAK,MAAO,eAAe,MAAO,SAAS,KAAK;AAC9D,UAAM,SAAS,KAAK,MAAO,gBAAgB,MAAO,SAAS,MAAM;AAGjE,UAAM,gBAAgB,MAAM,MAAM,WAAW,EACxC,QAAQ,EAAE,MAAM,KAAK,OAAO,OAAO,CAAC,EACpC,SAAS;AAGd,UAAM,SAAS,cAAc,SAAS,QAAQ;AAC9C,UAAM,aAAa,yBAAyB,MAAM;AAElD,WAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA,oBAAoB,EAAE,OAAO,SAAS,OAAO,QAAQ,SAAS,OAAO;AAAA,MACrE,gBAAgB,EAAE,MAAM,KAAK,OAAO,OAAO;AAAA,IAC/C;AAAA,EACJ,GAvCK;AAwCT,CAAC;",
  "names": []
}
